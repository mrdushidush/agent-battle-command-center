# =============================================================================
# Agent Battle Command Center - Environment Configuration
# =============================================================================
#
# RECOMMENDED: Run the setup script to auto-generate all keys:
#   bash scripts/setup.sh
#
# MANUAL: Copy this file to .env and replace all CHANGE_ME values:
#   cp .env.example .env
#   # Generate keys with: openssl rand -hex 32
#
# =============================================================================

# ============================ REQUIRED ====================================

# --- Database ---
POSTGRES_USER=postgres
POSTGRES_PASSWORD=CHANGE_ME_generate_with_openssl_rand_hex_32
POSTGRES_DB=abcc
# DATABASE_URL is only needed for local dev (non-Docker).
# The password here MUST match POSTGRES_PASSWORD above!
DATABASE_URL="postgresql://postgres:CHANGE_ME_generate_with_openssl_rand_hex_32@localhost:5432/abcc?schema=public"

# --- API Authentication ---
# Generate with: openssl rand -hex 32
API_KEY=CHANGE_ME_generate_with_openssl_rand_hex_32
# MUST be the SAME value as API_KEY (the UI uses this to authenticate with the API)
VITE_API_KEY=CHANGE_ME_generate_with_openssl_rand_hex_32

# --- Claude API ---
# Get yours at: https://console.anthropic.com/settings/keys
# Required for complex tasks (7+). Ollama handles simple tasks without this.
ANTHROPIC_API_KEY=sk-ant-api03-CHANGE_ME

# --- JWT ---
# Generate with: openssl rand -hex 32
JWT_SECRET=CHANGE_ME_generate_with_openssl_rand_hex_32

# --- xAI (Grok) API ---
# Get yours at: https://console.x.ai/
# Used for code tasks via grok-code-fast-1 model
XAI_API_KEY=xai-CHANGE_ME
XAI_BASE_URL=https://api.x.ai/v1
XAI_MODEL=grok-code-fast-1

# ============================ OPTIONAL ====================================

# --- API Server ---
API_PORT=3001
API_HOST=0.0.0.0
CORS_ORIGINS=http://localhost:5173,http://localhost:3000

# --- Rate Limiting ---
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX=100
RATE_LIMIT_SKIP_SUCCESSFUL=false

# --- Anthropic Rate Limiter (agents service) ---
# Buffer threshold: start throttling at this % of rate limit
RATE_LIMIT_BUFFER=0.8
# Minimum delay (seconds) between API calls
MIN_API_DELAY=0.5
# Enable debug logging for rate limiter
RATE_LIMIT_DEBUG=false

# --- Agents Service ---
AGENTS_URL=http://localhost:8000
AGENTS_PORT=8000

# --- UI ---
VITE_API_URL=http://localhost:3001
VITE_WS_URL=ws://localhost:3001

# --- Ollama (local LLM) ---
OLLAMA_URL=http://localhost:11434
# Required for Docker â€” must use Docker service name
OLLAMA_API_BASE=http://ollama:11434

# --- Model Settings ---
DEFAULT_MODEL=claude-sonnet-4-5-20250929
FALLBACK_TO_OLLAMA=true
OLLAMA_MODEL=qwen2.5-coder:7b

# --- Ollama Optimization ---
# Rest delays between tasks (prevents context pollution after consecutive tasks)
OLLAMA_REST_DELAY_MS=3000
# Extended rest every N tasks for deeper context clearing
OLLAMA_EXTENDED_REST_MS=8000
# How often to trigger extended rest
OLLAMA_RESET_EVERY_N_TASKS=3
# Tasks below this complexity go to Ollama (above goes to Claude)
OLLAMA_COMPLEXITY_THRESHOLD=7

# --- Cost Controls ---
# Daily budget limit in cents ($5.00 default)
BUDGET_DAILY_LIMIT_CENTS=500
# Warn when budget reaches this % of daily limit
BUDGET_WARNING_THRESHOLD=0.8

# --- Code Review Schedule ---
# Haiku reviews every Nth Ollama task
OLLAMA_REVIEW_INTERVAL=5
# Opus reviews every Nth task (complexity > 5 only)
OPUS_REVIEW_INTERVAL=10
# Minimum quality score to pass review (0-10)
REVIEW_QUALITY_THRESHOLD=6
# Enable automatic code reviews
AUTO_CODE_REVIEW=true

# --- Stuck Task Recovery ---
# Time (ms) before a task is considered stuck (default: 10 min)
STUCK_TASK_TIMEOUT_MS=600000
# How often (ms) to check for stuck tasks (default: 1 min)
STUCK_TASK_CHECK_INTERVAL_MS=60000
# Set to 'false' to disable auto-recovery
STUCK_TASK_RECOVERY_ENABLED=true

# --- Training Data Export ---
# Set to 'true' to enable automatic JSONL export for fine-tuning
TRAINING_EXPORT_ENABLED=false
# Export interval in hours
TRAINING_EXPORT_INTERVAL_HOURS=24
# Output directory inside the agents container
TRAINING_EXPORT_PATH=/app/workspace/training-exports

# --- Workspace ---
WORKSPACE_PATH=/app/workspace

# --- Human Escalation ---
HUMAN_TIMEOUT_MINUTES=30

# --- MCP Gateway (disabled by default) ---
# To enable: docker compose --profile mcp up
USE_MCP=false
MCP_GATEWAY_URL=http://localhost:8001
REDIS_URL=redis://localhost:6379/0

# --- Backup ---
# Mirror path for local filesystem backups (platform-agnostic)
# BACKUP_MIRROR_PATH=./backups

# --- MCP Sync (only when USE_MCP=true) ---
SYNC_FROM_POSTGRES_INTERVAL=1.0
SYNC_TO_POSTGRES_INTERVAL=5.0
TASK_CACHE_TTL=3600
FILE_LOCK_TIMEOUT=60
